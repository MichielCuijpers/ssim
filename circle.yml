machine:
  node:
    version: 6.7.0
general:
  artifacts:
    - "dist"
dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install libcairo2-dev libjpeg8-dev libpango1.0-dev libgif-dev build-essential g++
test:
  override:
    - npm run build
    - npm run test:e2e
    - npm run fixme
    - npm run lint
    - npm run docs
    - npm run codeclimate
    - cp -R coverage/* $CIRCLE_TEST_REPORTS
    - |
        if [ master == $CIRCLE_BRANCH ]; then
          nvm install 0.10.42 && nvm use 0.10.42 && bash ci/e2e.sh
          nvm install 0.12.2 && nvm use 0.12.2 && bash ci/e2e.sh
          nvm install 5.12.0 && nvm use 5.12.0 && bash ci/e2e.sh
        fi
deployment:
  publish:
    owner: obartra
    branch: master
    commands:
      - rm -rf node_modules
      - npm install
      - npm run build
      - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> ~/.npmrc
      - npm publish || exit 0
